<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#8b4513">
    <title>ุฏุงุดุจูุฑุฏ - ฺฉุงูู</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/dashboard" class="navbar-brand">โ ฺฉุงูู</a>
            <div class="navbar-user">
                <span class="user-badge" id="user-info">ฺฉุงุฑุจุฑ</span>
                <a href="#" id="logout-btn" class="btn btn-secondary btn-sm">ุฎุฑูุฌ</a>
            </div>
            <button class="navbar-toggle" id="navbar-toggle">โฐ</button>
            <ul class="navbar-menu mobile-hidden" id="navbar-menu">
                <li><a href="/dashboard" class="active">๐ ุฏุงุดุจูุฑุฏ</a></li>
                <li><a href="/new-order">โ ุณูุงุฑุด ุฌุฏุฏ</a></li>
                <li><a href="/orders">๐ ุณูุงุฑุดุงุช</a></li>
                <li id="admin-menu-item" style="display: none;"><a href="/admin">๐ฅ ฺฉุงุฑุจุฑุงู</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-items">
            <a href="/dashboard" class="bottom-nav-item active">
                <span class="icon">๐</span>
                ุฏุงุดุจูุฑุฏ
            </a>
            <a href="/new-order" class="bottom-nav-item">
                <span class="icon">โ</span>
                ุณูุงุฑุด
            </a>
            <a href="/orders" class="bottom-nav-item">
                <span class="icon">๐</span>
                ุณูุงุฑุดุงุช
            </a>
            <a href="#" id="logout-mobile" class="bottom-nav-item">
                <span class="icon">๐ช</span>
                ุฎุฑูุฌ
            </a>
        </div>
    </nav>
    
    <div class="container">
        <div class="page-header">
            <h1>๐ ุฏุงุดุจูุฑุฏ</h1>
            <p id="welcome-text">ุฎูุด ุขูุฏุฏ!</p>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="/new-order" class="quick-action">
                <div class="icon">โ</div>
                <span>ุณูุงุฑุด ุฌุฏุฏ</span>
            </a>
            <a href="/orders" class="quick-action">
                <div class="icon">๐</div>
                <span>ุณูุงุฑุดุงุช</span>
            </a>
            <a href="/orders?status=open" class="quick-action">
                <div class="icon">โณ</div>
                <span>ุฏุฑ ุงูุชุธุงุฑ</span>
            </a>
            <a href="/admin" class="quick-action" id="admin-action" style="display:none;">
                <div class="icon">๐ฅ</div>
                <span>ฺฉุงุฑุจุฑุงู</span>
            </a>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-icon orders">๐ฆ</div>
                <div class="stat-content">
                    <h3 id="total-orders">-</h3>
                    <p>ุณูุงุฑุด ุงูุฑูุฒ</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon revenue">๐ฐ</div>
                <div class="stat-content">
                    <h3 id="total-revenue">-</h3>
                    <p>ุฏุฑุขูุฏ ุงูุฑูุฒ</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon pending">โณ</div>
                <div class="stat-content">
                    <h3 id="pending-orders">-</h3>
                    <p>ุณูุงุฑุด ุจุงุฒ</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon products">โ</div>
                <div class="stat-content">
                    <h3 id="total-products">-</h3>
                    <p>ูุญุตูู</p>
                </div>
            </div>
        </div>
        
        <!-- Recent Orders -->
        <div class="card">
            <div class="card-header">๐ ุขุฎุฑู ุณูุงุฑุดุงุช</div>
            <div id="recent-orders">
                <div class="spinner"></div>
            </div>
        </div>
    </div>
    
    <script src="/static/app.js"></script>
    <script>
        // Check authentication
        if (!AuthManager.isAuthenticated()) {
            window.location.href = '/login';
        }
        
        // Get user info
        const user = AuthManager.getUser();
        if (user) {
            document.getElementById('user-info').textContent = user.full_name || user.username;
            document.getElementById('welcome-text').textContent = `ุฎูุด ุขูุฏุฏุ ${user.full_name || user.username}!`;
            
            if (user.role === 'admin') {
                document.getElementById('admin-menu-item').style.display = 'block';
                document.getElementById('admin-action').style.display = 'block';
            }
        }
        
        // Mobile navigation toggle
        document.getElementById('navbar-toggle').addEventListener('click', () => {
            const menu = document.getElementById('navbar-menu');
            menu.classList.toggle('mobile-hidden');
        });
        
        // Logout handlers
        document.getElementById('logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            AuthManager.logout();
            window.location.href = '/login';
        });
        
        document.getElementById('logout-mobile').addEventListener('click', (e) => {
            e.preventDefault();
            AuthManager.logout();
            window.location.href = '/login';
        });
        
        // Load dashboard data
        async function loadDashboard() {
            try {
                const dashboard = new DashboardManager();
                const stats = await dashboard.loadStats();
                
                if (stats) {
                    document.getElementById('total-orders').textContent = stats.today_orders || 0;
                    document.getElementById('total-revenue').textContent = 
                        new Intl.NumberFormat('fa-IR').format(stats.today_revenue || 0) + ' ุช';
                    document.getElementById('pending-orders').textContent = stats.pending_orders || 0;
                    document.getElementById('total-products').textContent = stats.products_count || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
            
            // Load recent orders
            try {
                const ordersManager = new OrdersManager();
                const orders = await ordersManager.loadOrders();
                
                const recentContainer = document.getElementById('recent-orders');
                
                if (orders && orders.length > 0) {
                    const recentOrders = orders.slice(0, 5);
                    recentContainer.innerHTML = recentOrders.map(order => `
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #eee;">
                            <div>
                                <strong>#${order.id}</strong>
                                <span style="color:#666;margin-right:8px;">
                                    ${order.table_number ? 'ูุฒ ' + order.table_number : 'ุจุฑููโุจุฑ'}
                                </span>
                            </div>
                            <div style="text-align:left;">
                                <span class="badge ${order.status === 'open' ? 'badge-warning' : 'badge-success'}">
                                    ${order.status === 'open' ? 'ุจุงุฒ' : 'ุจุณุชู'}
                                </span>
                                <div style="font-size:0.9rem;color:#666;margin-top:4px;">
                                    ${new Intl.NumberFormat('fa-IR').format(order.total || 0)} ุช
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    recentContainer.innerHTML = '<p style="text-align:center;color:#666;padding:20px;">ุณูุงุฑุด ุงูุช ูุดุฏ</p>';
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('recent-orders').innerHTML = 
                    '<p style="text-align:center;color:#666;padding:20px;">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ</p>';
            }
        }
        
        loadDashboard();
    </script>
</body>
</html>
